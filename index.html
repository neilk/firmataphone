<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="jquery-1.8.3.min.js"></script>
    <script src="handlebars-1.0.rc.1.js"></script>
    <script>

        function EvalSound(id) {
            var thisSound = document.getElementById(id);
            thisSound.Play();
        };

        Cycle = (function() {
            var cycle = {};
            cycle.chromatic = {
                'c': 'c',
                'c-sharp': 'c♯',
                'd': 'd',
                'e-flat': 'e♭',
                'e': 'e',
                'f': 'f',
                'f-sharp': 'f♯',
                'g': 'g',
                'a-flat': 'a♭',
                'a': 'a',
                'b-flat': 'b♭',
                'b': 'b'
            };

            // Initialize Cycle.chromatic
            $.each(cycle.chromatic, function(element, i) {
                var symbol = cycle.chromatic[element];
                cycle.chromatic[element] = {
                    symbol: symbol,
                    isPlaying: false
                };


                var pathTo = 'files/' + element + '.wav';
                $.ajax({
                    type: 'GET',
                    url: pathTo,
                    success: function() {
                        var sound = document.createElement('embed');
                        sound.setAttribute('src', pathTo);
                        sound.setAttribute('id', 'tone-' + element);
                        sound.setAttribute('hidden', 'true');
                        sound.setAttribute('autostart', false);
                        sound.setAttribute('width', 0);
                        sound.setAttribute('height', 0);
                        sound.setAttribute('enablejavascript', true);
                        document.body.appendChild(sound);
                    },
                    error: function(jqxhr) {
                        console.log('how does this work');
                        console.log(jqxhr);

                    }
                })

            });

            cycle.togglePlay = function(noteName) {
                if (!Cycle.chromatic[noteName]) {
                    return false;
                }

                if (Cycle.chromatic[noteName] && Cycle.chromatic[noteName].isPlaying == false) {
                    Cycle.chromatic[noteName].isPlaying = true;

                    var embedded = $('#tone-' + noteName);
                    if (embedded.length > 0) {
                        window.console.log(embedded)
                        EvalSound('tone-' + noteName);
                    }

                }
                return false;
            };

            return cycle;
        })();


        $(document).ready(function() {
            window.console.log(Cycle);

            // Generate buttons.
            $.each(Cycle.chromatic, function(element, i) {
                // Start loading source files.


                // Generate buttons.
                var source = Handlebars.compile($('#note-button-template').html());
                var button = source({ id: element, name: Cycle.chromatic[element].symbol });
                $('body').append(button);

            });

            $('.note-name').on('click', function(e) {
                e.preventDefault();
                Cycle.togglePlay($(this).attr('id'));
            });
        });
    </script>
    <style type="text/css">
        button {
            display: block;
            height: 22px;
            width: 30px;
            margin: 0.1em;
        }
    </style>
</head>
<body>

<embed src="files/a.wav"></embed>
</body>

<script id="note-button-template" type="text/x-handlebars-template">
    <button id="{{ id }}" class="note-name">{{ name }}</button>
</script>
</html>
